# Содержит решение тестового [задания](task.txt)
## Запуск

### Установка зависимостей

```sh
pip install -r requirements.txt
```

### Запуск скрипта

```sh
python script1.py
```

## Решение SQl задачи находится в файле [sql_task.sql](sql_task.sql)

## Пояснения к решению

### Считывание, очистка и фильтрация данных

- Считываются только необходимые для решения задачи колонки.
- Если значение в колонке не соответствует ожидаемому формату, то вся строка игнорируется.
    * Ожидается что даты будут в одном из 2 форматов: 'd/m/Y H:M' и 'mdY I:M p'
- Данные о платежах фильтруются по статусу; транзакции со статусами 'Failed' и 'Declined' считаются неудачными и игнорируются.

### Задание 1

Для решения задачи был разработан алгоритм для минимизации кол-ва переборов всех возможных комбинаций
(платёж - ставка - вывод), что позволяет снизить вычислительную сложность алгоритма с O(n^2 * m) (просто перебор) до
O(n * m) - в лучшем случае (все зависит от данных. Я предполагаю, что в среднем на реальных данных это будет
ближе к O(n * m)), где n - кол-во платежей, m - кол-во ставок

##### Про валюты

Поскольку задание зависит от соотношения суммы депозита к сумме ставки, необходимо учитывать валюту платежа и ставки, и
конвертировать их в одну валюту.

В ставках есть колонка settlement_exchange_rate, которая, как я понял, представляет собой курс обмена USD к валюте
ставки (поскольку при ставке в USD значение rate равно 1). Это единственная информация о курсе, доступная в данных, поэтому
мы можем сравнивать ставку и платеж только в случае, если валюта ставки и платежа совпадают, или если валюта депозита —
USD(т.к. можем конвертировать ставку в USD).

Понятно, что это не идеальное решение, и в идеале нужно подготовить данные по курсу для депозита.

#### Про границы времени

Тут хотелось бы пояснить что если ставка и платёж произошли в одно и то же время, то такая пара не учитывается
(предполагается что должна произойти после платежа), тоже касается и вывода.